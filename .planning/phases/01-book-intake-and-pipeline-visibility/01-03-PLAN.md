---
phase: 01-book-intake-and-pipeline-visibility
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - convex/jobs.ts
  - src/components/JobsPage.tsx
  - src/components/JobDetailsDrawer.tsx
  - src/lib/jobStatus.ts
autonomous: true
must_haves:
  truths:
    - "Job rows show stage and percent by default with human-friendly labels Queued/Running/Completed/Failed."
    - "Failed jobs show inline error snippets and allow expanding to full details/logs."
    - "When a book has multiple jobs, the default dashboard view shows grouped summary by state."
  artifacts:
    - path: "convex/jobs.ts"
      provides: "Queries for grouped-by-book job summaries and detailed job rows"
    - path: "src/components/JobsPage.tsx"
      provides: "Grouped summary UI with status labels, stage/progress, and inline failure snippet"
    - path: "src/components/JobDetailsDrawer.tsx"
      provides: "Expanded failure details and full log inspection"
  key_links:
    - from: "src/lib/jobStatus.ts"
      to: "src/components/JobsPage.tsx"
      via: "single status label map"
      pattern: "queued: \"Queued\""
    - from: "src/components/JobsPage.tsx"
      to: "api.jobs"
      via: "grouped summary query subscription"
      pattern: "useQuery\(api\.jobs\.[a-zA-Z]+"
    - from: "src/components/JobsPage.tsx"
      to: "src/components/JobDetailsDrawer.tsx"
      via: "expand failure details"
      pattern: "selectedJobId"
---

<objective>
Deliver pipeline observability UX that matches Phase 1 operations requirements and locked status/error presentation decisions.

Purpose: Make job execution understandable at a glance while preserving drill-down detail for failures and multi-job books.
Output: Updated jobs data queries and dashboard job views with grouped summaries, stage/progress, and failure detail expansion.
</objective>

<execution_context>
@/Users/boss/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/boss/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-book-intake-and-pipeline-visibility/01-CONTEXT.md
@convex/jobs.ts
@src/components/JobsPage.tsx
@src/components/JobDetailsDrawer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add job queries for grouped summaries and detailed failure context</name>
  <files>convex/jobs.ts</files>
  <action>Extend jobs module with queries that return (a) grouped summaries by book/state for default display and (b) detailed rows including stage, percent, concise error snippet, and full error/log details. Keep state taxonomy aligned to `queued|running|completed|failed` so the UI never mixes legacy `done/error` labels.</action>
  <verify>Run `npm run lint` and execute `npx convex run jobs.list` plus new summary query to confirm grouped and detailed payload shapes are returned.</verify>
  <done>Backend exposes all data required for grouped view, stage/progress rendering, and failure expansion without status drift.</done>
</task>

<task type="auto">
  <name>Task 2: Update Jobs page default view to grouped summaries with stage+percent</name>
  <files>src/components/JobsPage.tsx, src/lib/jobStatus.ts</files>
  <action>Refactor jobs page to default to grouped summaries for books with multiple jobs, display stage + percent by default on rows, and map canonical statuses to human-friendly labels (Queued/Running/Completed/Failed). Include clear inline snippet for failed jobs and an affordance to expand details.</action>
  <verify>Run `npm run lint`, open Jobs page, and verify grouped summaries, label mapping, and stage/percent are visible on first render.</verify>
  <done>OPS-01 and locked pipeline status display requirements are met in the default jobs dashboard state.</done>
</task>

<task type="auto">
  <name>Task 3: Expand failure details inline and in drawer</name>
  <files>src/components/JobsPage.tsx, src/components/JobDetailsDrawer.tsx</files>
  <action>Implement inline failed-job snippet with expandable details in the list row and align drawer content to show full error details/log context. Ensure expansion preserves current grouped context and does not hide the failed state indicator.</action>
  <verify>Create or use a failed intake job, then confirm inline snippet appears in list and expanding shows full details in row/drawer.</verify>
  <done>Failed jobs are immediately diagnosable from the jobs list with optional deeper inspection, satisfying OPS-02 and locked error-visibility decisions.</done>
</task>

</tasks>

<verification>
Validate that the Jobs page supports at-a-glance monitoring and actionable debugging: grouped states, stage/progress defaults, and expandable failure details.
</verification>

<success_criteria>
OPS-01 and OPS-02 are satisfied with canonical status labels, durable progress visibility, and inline + expanded error details for failed jobs.
</success_criteria>

<output>
After completion, create `.planning/phases/01-book-intake-and-pipeline-visibility/01-book-intake-and-pipeline-visibility-03-SUMMARY.md`
</output>
