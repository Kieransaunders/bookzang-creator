---
phase: 02-text-cleanup-and-editorial-approval
plan: 05
name: OpenRouter Phase 2A - UI Model Override and Verification
type: auto
autonomous: true
wave: implementation
depends_on: []
---

# Plan 02-05: OpenRouter Phase 2A - UI Model Override and Verification

**Objective:** Add UI controls for model override input and active-model alerts, then verify Phase 2A behavior with the openrouter/free test model.

**Context:**
- Backend chunking and routing implemented (Tasks 1-4 complete)
- Schema has ai* telemetry fields on cleanupRevisions
- CleanupReviewPage.tsx is the main review UI entry point
- Need to wire model selection through to the backend

---

## Task 1: Add UI model override input

**Type:** auto
**Files:**
- Create: `src/components/CleanupModelOverrideInput.tsx`
- Modify: `src/components/CleanupReviewPage.tsx`
- Modify: `convex/cleanupAi.ts` (accept modelOverride parameter)

**Implementation:**
1. Create CleanupModelOverrideInput component with:
   - Text input for OpenRouter model ID
   - Helper text: "Advanced: OpenRouter model id (e.g., openrouter/anthropic/claude-3.5-sonnet)"
   - Validation: max 100 chars, safe charset [a-zA-Z0-9/_\.:-]
   - Optional prop, defaults to empty (use server default)

2. Add to CleanupReviewPage:
   - State for modelOverride input
   - Pass to AI cleanup mutation when triggered

3. Update cleanupAi mutation to accept modelOverride parameter

**Done When:**
- Input visible in review UI
- Value passed through to backend mutation
- Validation prevents invalid input

---

## Task 2: Add active-model alert banner

**Type:** auto
**Files:**
- Modify: `src/components/CleanupReviewPage.tsx`

**Implementation:**
1. After AI cleanup completes, show banner with:
   - "Model used: {resolvedModel}"
   - "Fallback activated" warning badge if fallbackUsed=true
   - Chunk stats: "Processed in {chunkCount} chunks"

2. Use existing liquid-glass alert styling from the project

**Done When:**
- Banner appears after AI processing
- Shows resolved model and fallback status
- Displays chunk count

---

## Task 3: Verify Phase 2A with openrouter/free model

**Type:** auto
**Files:**
- Create: `docs/plans/2026-02-13-openrouter-phase-2a-verification.md`

**Verification Checklist:**
1. Run cleanup with explicit model override "openrouter/free"
2. Verify telemetry shows requestedModel="openrouter/free"
3. Test chunking with long text (should show chunkCount > 1)
4. Document verification results

**Done When:**
- Verification doc created with evidence
- Test with openrouter/free successful (or documented failure)
- npm run lint passes
- npm run test:cleanup-policy passes

---

## Success Criteria

- [ ] Model override input visible in review UI
- [ ] Active model banner shows resolved model and fallback status
- [ ] Chunk stats visible after processing
- [ ] Verification doc shows test evidence
- [ ] All 39 tests pass
- [ ] TypeScript compilation succeeds

## Output

SUMMARY.md documenting:
- UI components added
- Backend parameter wiring
- Verification test results
